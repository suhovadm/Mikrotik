# Примитивный скрипт, который тестирует 514 порт, чтобы можно было слить логи с Микротика.

# Импортируем модуль socket для работы с сетевыми соединениями.
import socket

# Заводим функцию, которая будет проверять доступность порта.
def test_port():
    try:
        # Создаём UDP сокет.
        # socket.AF_INET - используем IPv4 адресацию.
        # socket.SOCK_DGRAM - используем UDP протокол.
        # Почему UDP?
        # 1) Не треубет установления соединения (handshake).
        # 2) TCP требует 3-way handshake перед отправкой данных.
        # 3) Для логов, которые идут постоянным потоком, это критично.
        # Логи обычно статические - потеря нескольких сообщений не фатальна.
        # 4) UDP - "отправил и забыл", быстрее но без гарантии доставки.
        # TCP - гарантированная доставка, но медленнее и ресурсоёмко.
        # 5) Протокол syslog изначально спроектирован под UDP.
        # Стандарт RFC 3168 определяет syslog over UDP, порт 514.
        # TCP версия появилась позже.
        # 6) В локальной сети потери пакетов вообще будут минимальны.
        # UDP работает даже при временных проблемах с сетью, TCP может "зависнуть" при потере соединения.
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

        # 0.0.0.0 - слушаем всю сеть и 514 порт (стандартный для syslog).
        sock.bind(('0.0.0.0', 514))
        print("✓ Порт 514 успешно открыт")

        # Закрываем сокет, освобождаем порт после проверки.
        sock.close()

        # Возвращаем True. Функция сообщает, что проверка прошла успешно.
        return True

    # Обработка ошибки прав доступа - возникает если у программы нет прав на открытие системного порта.
    except PermissionError:
        print("✗ Ошибка прав доступа. Запусти от администратора!")
        return False

    # Обработка других системных ошибок - например, если порт уже занят.
    except OSError as e:
        print(f"✗ Ошибка: {e}") # Вывод конкретной ошибки покажет что именно пошло не так.
        return False

# Точка входа в программу, запуск основного модуля.
if __name__ == "__main__":

    test_port() # Вызов функции, запуск проверки порта.
